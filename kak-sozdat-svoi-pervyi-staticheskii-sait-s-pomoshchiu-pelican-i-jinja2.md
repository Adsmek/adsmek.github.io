Title: Как создать свой первый статический сайт с помощью Pelican и Jinja2
date: 2017-05-06
modified: 2020-08-07
tags: перевод
category:
slug: 
author: Мэтт Макай
summary: Полный стек Python создается с помощью шаблонов Pelican, Jinja2 и Markdown. Этот сайт развернут на Amazon S3 и в настоящее время обслуживает более ста тысяч читателей в месяц. Проблемы масштабирования никогда не возникают, потому что статический сайт предварительно создается перед развертыванием, а веб-сервер просто отвечает существующими файлами, а не выполняет какой-либо код на сервере во время цикла HTTP-запроса-ответа.


# [Как создать свой первый статический сайт с помощью Pelican и Jinja2](https://adsmek.github.io/how-to-create-your-first-static-site-with-pelican-and-jinja2.html "Постоянная ссылка на Как создать свой первый статический сайт с помощью Pelican и Jinja2 (en)")

Автор: Мэтт Макай, 9 июня 2017 г. Pelican - это невероятно хорошо продуманный инструмент Python для создания статических сайтов.

Полный стек Python создается с помощью шаблонов Pelican, Jinja2 и Markdown. Этот сайт развернут на Amazon S3 и в настоящее время обслуживает более ста тысяч читателей в месяц. Проблемы масштабирования никогда не возникают, потому что статический сайт предварительно создается перед развертыванием, а веб-сервер просто отвечает существующими файлами, а не выполняет какой-либо код на сервере во время цикла HTTP-запроса-ответа.

Из этого туториала Вы узнаете, как создать собственный статический веб-сайт с нуля с помощью Pelican.

Страница статей после добавления Bootstrap CSS.

На нашем простом статическом сайте будут страницы, похожие на приведенный выше снимок экрана, но весь сайт можно легко настроить и расширить с помощью вашего собственного дизайна и контента.

Наши инструменты Это руководство должно работать с Python 2 или 3, но Python 3 настоятельно рекомендуется для всех новых приложений. Я использовал Python 3.6.1, чтобы написать этот пост. В дополнение к Python в этом руководстве мы также будем использовать следующие зависимости приложений:

Генератор статических сайтов Pelican, библиотека анализа Markdown версии 3.7.1 для обработки Markdown в качестве формата ввода контента, версия 2.6.8 Jinja2, механизм шаблонов Python, версия 2.9.6 pip и virtualenv, которые поставляются в комплекте с Python 3, для установки и изолировать библиотеки Pelican, Markdown и Jinja2 от любых других ваших проектов Python. Если вам нужна помощь в настройке среды разработки, ознакомьтесь с этим руководством по настройке Python 3 и Flask в Ubuntu 16.04 LTS.

Весь код в этом сообщении в блоге доступен с открытым исходным кодом под лицензией MIT на GitHub в каталоге generate-static-sites-pelican-jinja2-markdown репозитория blog-code-examples. Используйте и злоупотребляйте исходным кодом для своих собственных приложений.

Установите библиотеки Pelican и Markdown. Начните с создания новой виртуальной среды для вашего проекта. Мой virtualenv называется staticsite, но вы можете назвать свое имя, которое соответствует создаваемому вами проекту.

python3 -m venv staticsite Активировать файл virtualenv.

source staticsite / bin / activate. virtualenv добавит свое имя к командной строке при активации.

Создайте и активируйте виртуальную среду Python.

После активации virtualenv установите соответствующие зависимости. Используйте команду pip для установки Pelican и Markdown, которые также установят Jinja2, потому что Pelican указывает его как зависимость.

pip install pelican == 3.7.1 markdown == 2.6.8 Запустите команду pip, и после того, как все будет установлено, вы должны увидеть вывод, аналогичный следующему сообщению «Успешно установлено».

Установка собранных пакетов: pygments, pytz, six, feedgenerator, blinker, unidecode, MarkupSafe, jinja2, python-dateutil, Docutils, pelican, markdown Запуск setup.py install для feedgenerator ... готово Запуск setup.py install для blinker ... done Запуск setup.py install для MarkupSafe ... done Запуск setup.py install для markdown ... done Успешно установлен MarkupSafe-1.0 blinker-1.4 Docutils-0.13.1 feedgenerator-1.9 jinja2-2.9.6 markdown-2.6.8 pelican -3.7.1 pygments-2.2.0 python-dateutil-2.6.0 pytz-2017.2 six-1.10.0 unidecode-0.4.20 Теперь, когда наши зависимости установлены в virtualenv, мы можем приступить к созданию нашего статического сайта.

Создание базового сайта Создайте новый каталог для хранения вашего проекта. Мой сайт будет содержать в качестве примеров некоторых из моих любимых исполнителей ретро-синтвейва, но, конечно, ваш сайт может содержать любые темы, которые вы хотите.

После создания перейдите в каталог проекта.

mkdir retrosynth cd retrosynth Запустить команду pelican-quickstart в новом каталоге проекта.

(staticsite) $ pelican-quickstart Скрипт быстрого запуска ответит на кучу вопросов. Следуйте приведенным ниже ответам или измените их для своего собственного имени сайта и желаемой конфигурации.

Добро пожаловать в pelican-quickstart v3.7.1. Этот скрипт поможет вам создать новый веб-сайт на основе Пеликана. Пожалуйста, ответьте на следующие вопросы, чтобы этот сценарий мог сгенерировать файлы, необходимые Pelican.

> Где вы хотите создать свой новый веб-сайт? [.] Как будет называться этот веб-сайт? RetroSynthwave Кто будет автором этого веб-сайта? Мэтт Макай Какой язык будет по умолчанию на этом веб-сайте? [ru] Вы хотите указать префикс URL? например, http://example.com (Y / n) n Вы хотите включить нумерацию статей? (Д / нет) n Какой у вас часовой пояс? [Европа / Париж] Америка / Нью-Йорк Хотите создать Fabfile / Makefile для автоматизации создания и публикации? (Д / нет) Да Вы хотите автоматическую перезагрузку и Сценарий simpleHTTP для помощи в разработке тем и сайтов? (Д / нет) Да Вы хотите загрузить свой сайт через FTP? (да / Нет) n Вы хотите загрузить свой веб-сайт с помощью SSH? (да / Нет) n Вы хотите загрузить свой веб-сайт с помощью Dropbox? (да / нет) n Вы хотите загрузить свой веб-сайт с помощью S3? (Да / Нет) Да Как называется ваша корзина S3? [my_s3_bucket] Хотите загрузить свой сайт с помощью Rackspace Cloud Files? (да / Нет) n Вы хотите загрузить свой сайт с помощью GitHub Pages? (да / нет) нет Готово. Ваш новый проект доступен по адресу / Users / matt / devel / py / retrosynth (staticsite) $ Что мы только что создали с помощью сценария быстрого запуска Pelican? Проверьте новые файлы в каталоге. Ваш новый проект доступен по адресу / Users / matt / devel / py / retrosynth (staticsite) $ Что мы только что создали с помощью сценария быстрого запуска Pelican? Проверьте новые файлы в каталоге. Ваш новый проект доступен по адресу / Users / matt / devel / py / retrosynth (staticsite) $ Что мы только что создали с помощью сценария быстрого запуска Pelican? Проверьте новые файлы в каталоге.

(staticsite) $ ls Makefile develop_server.sh pelicanconf.py content fabfile.py publishconf.py При быстром запуске были созданы пять файлов и один новый каталог:

Makefile: выполнение командных задач для общих операций, таких как запуск сервера разработки, создание сайта и очистка посторонних файлов сборки fabfile.py: файл Fabric, который содержит некоторые из тех же типов команд, что и Makefile. Fabric - прекрасная библиотека кода, но пока я рекомендую пропустить файл Fabric, потому что, к сожалению, Fabric еще не поддерживает Python 3. develop_server.sh: сценарий оболочки для запуска сервера разработки pelicanconf.py: файл настроек для вашего проекта Pelican. Если вы привыкли к более ранним версиям Pelican, то вместо этого этот файл назывался settings.py publishconf.py: другой (необязательный) файл настроек, который можно рассматривать как «рабочий» файл настроек, когда вы переходите из этапа разработки и хотите развернуть свой контент сайта: расположение ваших файлов разметки, которые должны храниться в каталогах страниц и сообщений. Мы можем использовать эти файлы в качестве основы для нашего нового статического сайта. Давайте посмотрим, как это выглядит по умолчанию, запустив его через задачу devserver в Makefile.

make devserver Сервер разработки Pelican начнет обслуживать ваш сайт с помощью процесса-демона. Перейдите на localhost: 8000 в своем браузере, и вы увидите первую версию своего статического сайта.

Стиль по умолчанию на статическом сайте Pelican.

Что делать, если в вашей системе не установлена ​​программа make? Перейдите в выходной каталог и используйте команду python -m http.server, чтобы использовать встроенный HTTP-сервер Python 3 для ваших сгенерированных файлов.

Если вы хотите убить сервер разработки, найдите файл с именем pelican.pid в каталоге вашего проекта. Файл pelican.pid создается Pelican и содержит идентификатор процесса для вашего сервера разработки.

(staticsite) $ cat pelican.pid 1365 Используйте команды ps и grep для просмотра процесса, а затем остановите его с помощью команды kill, как показано ниже. Помните, что ваш идентификатор процесса почти наверняка будет отличаться от идентификатора 1365 для моего процесса.

Завершите работу сервера разработки сейчас, чтобы мы могли использовать различные команды для обслуживания нашего сайта после создания нашего исходного контента.

(статический сайт) $ ps -A | grep 1365 1365 ttys003 0: 01.43 /Library/Frameworks/Python.framework/Versions/3.6/Resources/Python.app/Contents/MacOS/Python / Users / matt / Envs / staticsite / bin / pelican --debug --autoreload - r / Users / matt / devel / py / retrosynth / content -o / Users / matt / devel / py / retrosynth / output -s /Users/matt/devel/py/retrosynth/pelicanconf.py 1411 ttys003 0: 00.00 grep 1365 (статический сайт) $ kill 1365 (статический сайт) $ ps -A | grep 1365 1413 ttys003 0: 00.00 grep 1365 От вас зависит, хотите ли вы использовать сервер разработки при создании своего сайта. Каждый раз, когда я хочу просмотреть свои изменения для Full Stack Python, я регенерирую сайт, используя свой собственный Makefile, который является оболочкой для команды pelican. Команда python -m http.server постоянно обслуживает изменения каждой сборки.

Хорошо, теперь, когда у нас есть стартовые файлы, мы можем приступить к работе над созданием начального контента.

Напишите некоторый контент Pelican может принимать в качестве входных данных файлы разметки Markdown и reStructureText.

Создайте новый подкаталог под содержимым с именем posts. Перейдите в каталог сообщений. Создайте новый файл с именем gunship.markdown со следующим содержимым.

название: Gunship Slug: [Gunship](https://www.gunshipmusic.com/) категория: группы дата: 2017-06-09 изменено: 2017-06-09 [Gunship](https://www.gunshipmusic.com/) - _ретро-синтвейв-_ исполнитель из Великобритании. [Revel in Your Time](https://www.youtube.com/watch?v=uYRZV8dV10w) , [Tech Noir](https://www.youtube.com/watch?v=-nC5TBv3sfU) , [Fly for Your Life](https://www.youtube.com/watch?v=Jv1ZN8c4_Gs) и [The Mountain](https://www.youtube.com/watch?v=-HYRTJr8EyA) - все это качественные песни Gunship. Посмотрите эти потрясающие музыкальные клипы! Также обратите внимание на других ретро-synthwave-исполнителей, таких как [Trevor Something](https://trevorsomething.bandcamp.com/) , [Droid Bishop](https://droidbishop.bandcamp.com/) , [FM-84](https://fm84.bandcamp.com/) и [Daniel Deluxe](https://danieldeluxe.bandcamp.com/) . Наш make-файл также может помочь нам восстановить сайт при внесении изменений, если мы решим не использовать сервер разработки.

Ранее мы использовали задачу devserver, но какие еще задачи доступны нам через Makefile?

make make должен показать нам все следующие задачи, которые мы можем выполнить.

Makefile для веб-сайта пеликана Использование: make html (re) сгенерировать веб-сайт make clean удалить сгенерированные файлы заставить регенерировать регенерировать файлы после модификации make опубликовать сгенерировать с использованием производственных настроек make serve [PORT = 8000] serve site at http: // localhost : 8000 make serve-global [SERVER = 0.0.0.0] serve (как root) для: 80 make devserver [PORT = 8000] start / restart develop_server.sh сделать stopserver остановить локальный сервер заставить ssh_upload загрузить веб-сайт через SSH сделать rsync_upload загрузить веб-сайт через rsync + ssh сделать dropbox_upload загрузить веб-сайт через Dropbox сделать ftp_upload загрузить веб-сайт через FTP заставить s3_upload загрузить веб-сайт через S3 сделать cf_upload загрузить веб-сайт через Cloud Files заставить github загрузить веб-сайт через gh-страницы Установите для переменной DEBUG значение 1, чтобы включить отладку, напримерmake DEBUG = 1 html Установите для переменной RELATIVE значение 1, чтобы включить относительные URL-адреса. Задача html - это то, что мы ищем для вызова команды pelican с использованием нашего файла настроек pelicanconf.py.

(staticsite) $ make html pelican / Users / matt / devel / py / retrosynth / content -o / Users / matt / devel / py / retrosynth / output -s /Users/matt/devel/py/retrosynth/pelicanconf.py Готово : Обработано 1 статья, 0 черновиков, 0 страниц и 0 скрытых страниц за 0,14 секунды. Наш сайт был регенерирован и помещен в выходной каталог.

Если вы использовали команду make devserver ранее, перейдите в выходной каталог и дайте возможность встроенному HTTP-серверу Python с помощью следующей команды.

cd output python -m http.server Наш первый пост во всей красе ...

Gunship в качестве первого поста нашей группы на статическом ретро-сайте synthwave.

Вы можете изменить привязку порта HTTP-сервера, добавив номер после команды, если вы хотите обслуживать более одного статического сайта одновременно или у вас уже есть приложение, привязанное к порту 8000.

python -m http.server 8005 Обратите внимание: если вы используете Python 2, эквивалентная команда HTTP-сервера - python -m SimpleHTTPServer.

На нашем сайте теперь есть очень простой контент. Мы могли бы расширить это начало на гораздо больше сообщений и страниц, но давайте узнаем, как изменить конфигурацию сайта.

Редактировать конфигурацию сайта Краткое руководство Pelican предполагает ряд настроек по умолчанию, которые могут или не могут быть применимы к вашему сайту. Откройте файл pelicanconf.py, чтобы изменить некоторые значения по умолчанию.

Найдите переменную TIMEZONE. Если это не подходит для вашего местоположения, измените его на свою зону. В Википедии есть удобная таблица допустимых значений часовых поясов.

Также измените кортеж LINKS, включив в него ваш сайт (или полный стек Python!) Вместо ссылки «вы можете изменить эти ссылки». Измените последнюю строку LINKS так, чтобы она выглядела как следующий кортеж кортежей.

# Blogroll

    LINKS = (('Пеликан', 'http://getpelican.com/'), ('Python.org', 'http://python.org/'), ('Jinja2', 'http: // jinja .pocoo.org / '), (' Full Stack Python ',' https://www.fullstackpython.com/ '),) 

Вместо использования файла make html на этот раз мы вызовем команду pelican непосредственно из команды линия. В Makefile нет ничего плохого, но неплохо освоить Pelican напрямую, а не только через файлы сборки.

    pelican -s pelicanconf.py -o output content

Теперь запустите HTTP-сервер, если он еще не запущен в другом окне терминала.

cd output python -m http.server Вернитесь в браузер и обновите страницу, чтобы просмотреть обновленную конфигурацию.

Новые ссылки, созданные файлом настроек конфигурации pelicanconf.py.

Что происходит, когда мы нажимаем на заголовок сообщения в блоге? Он переносит нас на очень похожую страницу с URL-адресом localhost: 8000 / gunship.html.

Дополнительная страница Gunship для сайта.

Хорошо, мы обновили некоторые основные данные по всему сайту, но нашему сайту действительно нужно изменить окраску.

Изменение темы сайта Изменение темы сайта - это действительно то место, где вы можете превратить стандартный блог в сайт любого типа, который вы хотите создать. Хотя стандартная конфигурация Pelican создает шаблон блога, вам не нужно иметь хронологическую структуру, если она не подходит для вашего сайта.

Создайте новый каталог в каталоге вашего проекта с именем theme. В теме создайте еще один каталог с именем templates. Шаблоны - это место, где будут храниться наши шаблоны Jinja2, которые могут заменять тему по умолчанию.

Начните с создания файла с именем base.html, в котором будет храниться шаблон, используемый шаблонами на сайте.

```
<!DOCTYPE html>
<html lang="en">
<head>
 <title>{% block title %}{% endblock %}</title>
</head>
<body>
 <div class="container">
 {% block content %}{% endblock %}
 </div>
</body>
</html>

```

В теме / шаблонах создайте файл с именем article.html, который будет иметь тему для сообщений блога, отличную от остальной части сайта. Заполните article.html следующей разметкой Jinja2.

```
{% extends "base.html" %}
{% block title %}{{ article.title }}{% endblock %}
{% block content %}
<div class="row">
 <div class="col-md-8">
 <h1>{{ article.title }}</h1>
 <label>Posted on <strong>{{ article.date }}</strong></label>
 {{ article.content }}
 </div>
</div>
{% endblock %}

```

Затем мы воспользуемся шаблоном Jinja2, чтобы переопределить главную страницу index.html по умолчанию. Снова в каталоге theme / templates создайте файл с именем index.html со следующей разметкой.

```
{% extends "base.html" %}
{% block title %}{{ SITENAME }}{% endblock %}
{% block content %}
<div class="row">
 <div class="col-md-8">
 <h1>{{ SITENAME }}</h1>
 {% for article in articles %}
 <h2><a href="/{{ article.slug }}.html">{{ article.title }}</a></h2>
 <label>Posted on <strong>{{ article.date }}</strong></label>
 {{ article.content|truncate(110) }}
 {% else %}
 No posts yet!
 {% endfor %}
 </div>
</div>
{% endblock %}

```

Восстановите сайт и убедитесь, что вы обслуживаете его с помощью сервера разработки или команды python -m http.server.

Обязательно используйте новый флаг темы -t, чтобы указать, что шаблоны Jinja2 в каталоге тем должны применяться к сайту.

pelican -s pelicanconf.py -o output -t theme content Перейдите на localhost: 8000 и обновите страницу. Стиль на главной странице теперь другой, потому что он использует тему index.html.

Страница index.html без применения стилей.

Щелкните заголовок сообщения о боевом корабле. На этой странице используется шаблон article.html, хотя трудно сказать, потому что к странице не применен CSS.

Статьи имеют совершенно другую тему, основанную на разметке article.html.

Довольно редко! Мы можем по крайней мере добавить CSS Bootstrap в HTML, чтобы выровнять наш контент.

Внутри `base.html`добавьте следующую строку для Bootstrap ниже `<title>{% block title %}{% endblock %}</title>`и выше `</head>`.

```
<!-- Latest compiled and minified Bootstrap CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

```

Восстановите сайт и обновите страницу Gunship.

Страница статей после добавления Bootstrap CSS.

По крайней мере, наш дизайн переместился с 1996 на 2001. Я уверен, что вы можете сделать гораздо больше, чтобы улучшить дизайн своего сайта.

Новый base.html пока не предоставляет много темы, но, по крайней мере, обеспечивает новый старт для полностью настраиваемых сайтов.

Что дальше? Вы создали свой первый статический веб-сайт Pelican, используя Markdown и Jinja2. В шаблоны Jinja2 и содержимое файлов Markdown можно внести дополнительные изменения.

Вы хотите развернуть свой новый статический веб-сайт на страницах GitHub или в сегменте S3? Что ж, это история для другого учебника Full Stack Python ...

Вопросы? Дайте мне знать через тикет о выпуске GitHub в репозитории Full Stack Python, в Twitter @fullstackpython или @mattmakai.

Видите что-то не так в этом сообщении в блоге? Разверните исходный код этой страницы на GitHub и отправьте запрос на перенос.